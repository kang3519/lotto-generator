<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>로또 번호 생성기 – v12 (1등 패턴 매칭)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.5.0/kakao.min.js" defer onload="Kakao.init('13aaec94bd811a32bbb688c8b1a37ba2');"></script>
  <style>
    :root{--red:#e74c3c;--orange:#f39c12;--green:#27ae60;--blue:#2980b9;--purple:#8e44ad;--primary:#3498db}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial,Helvetica,sans-serif;background:#f9fafb;display:flex;justify-content:center;padding:24px}
    .container{width:100%;max-width:820px;display:flex;flex-direction:column;gap:16px}
    .card{background:#fff;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.1);padding:16px;width:100%}
    h1,h2,h3{text-align:center;margin:6px 0}
    .num{width:36px;height:36px;line-height:36px;border-radius:50%;margin:3px;color:#fff;text-align:center;font-weight:600;display:inline-block}
    .set{display:flex;justify-content:center;flex-wrap:wrap}
    .r1{background:var(--red)}.r2{background:var(--orange)}.r3{background:var(--green)}.r4{background:var(--blue)}.r5{background:var(--purple)}
    .btn{display:inline-flex;align-items:center;gap:6px;margin:6px 10px;padding:8px 22px;background:var(--primary);color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:1rem}
    .btn:hover{background:#2378be}
    .btn-row{display:flex;justify-content:center;flex-wrap:wrap}
    .progress-bar{width:100%;height:12px;background:#eee;border-radius:6px;overflow:hidden;margin:8px 0}
    .progress-bar-inner{height:100%;background:var(--primary);width:0;transition:width .3s ease}
    .share-row{display:flex;justify-content:center;gap:14px;flex-wrap:wrap;margin-top:6px}
    .share-btn img{width:28px;height:28px}
    #error{color:var(--red);text-align:center;margin-top:6px}
    canvas{max-width:100%;height:auto}
  </style>
</head>
<body>
<div class="container">
  <!-- 헤더 & 진행 -->
  <section class="card" id="card-latest">
    <h1 style="background:linear-gradient(90deg,var(--red),var(--orange),var(--green),var(--blue),var(--purple));-webkit-background-clip:text;color:transparent;font-weight:700">로또 번호 생성기 🎉</h1>
    <h3 id="last-info">AI 패턴 분석 중...</h3>
    <div id="last-numbers" class="set"></div>
    <div class="progress-bar"><div class="progress-bar-inner"></div></div>
  </section>
  <!-- 패턴 매칭 추천 -->
  <section class="card">
    <h2>1등 패턴 근접 추천 3세트</h2>
    <div id="pattern-reco"></div>
    <small id="pattern-desc" style="display:block;text-align:center;color:#555"></small>
  </section>
  <!-- 일반 무작위 -->
  <section class="card">
    <h2>일반 번호 2세트</h2>
    <div id="random"></div>
    <div class="btn-row"><button class="btn" id="btn-generate">새로운 번호 생성</button><button class="btn" id="btn-shot">📸 캡처 PNG</button></div>
  </section>
  <!-- 빈도 그래프 -->
  <section class="card">
    <h3>최근 100회 번호 출현 빈도</h3>
    <canvas id="freqChart" height="240"></canvas>
  </section>
  <!-- 공유 -->
  <section class="card">
    <h2>공유하기</h2>
    <div class="share-row">
      <button class="btn share-btn" id="share-kakao"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/kakaotalk.svg" alt="kakao">카카오톡</button>
      <button class="btn share-btn" id="share-twitter"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg" alt="twitter">X</button>
      <button class="btn share-btn" id="share-copy"><img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/link.svg" alt="copy">링크 복사</button>
    </div>
  </section>
  <div id="error"></div>
</div>
<script>
/******** helpers ********/
const PROXIES=[u=>`https://thingproxy.freeboard.io/fetch/${u}`,u=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,u=>`https://corsproxy.io/?${encodeURIComponent(u)}`];
async function fetchJSON(u){for(const p of PROXIES){try{return await fetch(p(u)).then(r=>r.json());}catch{}}throw 'fetch 실패';}
const colorClass=n=>n<=10?'r1':n<=20?'r2':n<=30?'r3':n<=40?'r4':'r5';
const ball=n=>`<span class="num ${colorClass(n)}">${n}</span>`;
function renderSet(el,sets){el.innerHTML=sets.map(s=>`<div class="set">${s.map(ball).join('')}</div>`).join('');}
function pick(arr){const src=arr.slice(),o=[];while(o.length<6) o.push(src.splice(Math.random()*src.length|0,1)[0]);return o.sort((a,b)=>a-b);}
/******** globals ********/
let chart,history=[],avgStats={};
/******** fetch draws ********/
async function latestNo(){const base=Math.floor((Date.now()-Date.UTC(2002,11,7))/6048e5)+5;for(let n=base;n>base-60;n--){const d=await fetchJSON(`https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=${n}`);if(d&&d.returnValue==='success')return n;}throw '최신 회차 실패';}
function statsOf(set){return{sum:set.reduce((a,b)=>a+b,0),odd:set.filter(x=>x%2).length,high:set.filter(x=>x>30).length};}
function avg(arr){return arr.reduce((a,b)=>a+b,0)/arr.length;}
/******** load ********/
async function loadData(){const err=document.getElementById('error');err.textContent='';const bar=document.querySelector('.progress-bar-inner');bar.style.width='0%';
  const latest=await latestNo();
  const res=await Promise.allSettled([...Array(100).keys()].map(i=>latest-i).map(n=>fetchJSON(`https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=${n}`)));
  res.forEach((r,i)=>{bar.style.width=`${((i+1)/res.length*100).toFixed(0)}%`;if(r.status==='fulfilled'&&r.value&&r.value.returnValue==='success'){history.push([1,2,3,4,5,6].map(k=>r.value[`drwtNo${k}`]));}});
  if(!history.length){err.textContent='데이터 수집 실패';return;}
  document.getElementById('last-info').textContent=`최근 회차 ${latest} 번호`;
  document.getElementById('last-numbers').innerHTML=history[0].map(ball).join('');
  /* 평균 */
  const sArr=history.map(statsOf);
  avgStats={sum:avg(sArr.map(s=>s.sum)),odd:avg(sArr.map(s=>s.odd)),high:avg(sArr.map(s=>s.high))};
  document.getElementById('pattern-desc').textContent=`목표 패턴 ▸ 합계≈${avgStats.sum.toFixed(0)}, 홀수≈${avgStats.odd.toFixed(1)}, 고수(31~45)≈${avgStats.high.toFixed(1)}개`;
  /* 빈도 그래프 */
  const freq={};history.flat().forEach(n=>freq[n]=(freq[n]||
